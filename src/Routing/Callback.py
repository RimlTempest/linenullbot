from flask import request, abort
from linebot.exceptions import InvalidSignatureError

from src.app.main import app, handler


class Callback:
    @staticmethod
    def ret():
        signature = request.headers['X-Line-Signature']

        # get request body as text
        body = request.get_data(as_text=True)
        app.logger.info("Request body: " + body)

        # handle webhook body
        try:
            handler.handle(body, signature)
        except InvalidSignatureError:
            abort(400)

        return 'OK'
